<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>OpenStack Cloud Maker - Cluster Configuration & Deployment</title>
<link rel="stylesheet" href="css/jquery-ui.css">
<link rel="stylesheet" href="css/tab_style.css">
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/bootstrap-editable.css">
<link rel="stylesheet" href="css/select2.css">
<link rel="stylesheet" href="css/select2-bootstrap.css">


<script src="js/jquery-1.js" type="text/javascript"></script>
<script src="js/jquery-ui.js" type="text/javascript"></script>
<script src="js/bootstrap.js" type="text/javascript"></script>
<script src="js/bootstrap-editable.js" type="text/javascript"></script>
<script src="js/select2.js" type="text/javascript"></script>
<script src="js/jquery.js" type="text/javascript"></script     
	 
<script src="/_utils/script/json2.js"></script>
<script src="/_utils/script/sha1.js"></script>
<script src="/_utils/script/jquery.dialog.js?0.11.0"></script>	
<script src="js/common.js"></script>	

  <script>
  $(function() {
    $( "#tabs" ).tabs().addClass( "ui-tabs-vertical ui-helper-clearfix" );
    $( "#tabs li" ).removeClass( "ui-corner-top" ).addClass( "ui-corner-left" );
  });
  </script>
  
        <script>
         	
        </script>  
  
  
  <script>
  
  var cloud_nodes;
  var chef_roles;
  
  var isNew=true;
  var currentID;
  var currentRevID;
  
  var loadClusterObject;
  var loadedBaseObject;
  var loadedHAObject;
  var loadedNodesObj ={};	
  
  var progressLogShowInterval;
  var deploymentLogShowInterval;
  var cleanLogShowInterval;

  //$('#horizonadmin').hide(); 
  //$('#horizonadmin').attr('disabled', true);
  $('#result').val("");
  
  var oldID;
  var oldRevID;
  var oldClusterName;

  var SERVER_IP = location.hostname;
  var countries = [];
   
  jQuery(document).ready(function($){
    
	 $(".nextButton").click(function(e){
			
		var currentTabIndex = $("#tabs1").tabs("option", "active");
		//console.log("currentTabIndex : " + currentTabIndex);
		
		if(currentTabIndex !=6)
		{
			$("#tabs1").tabs("option", "active", currentTabIndex+1);
		}
	 
	 });
	 
	 $(".backButton").click(function(e){
			
		var currentTabIndex = $("#tabs1").tabs("option", "active");
		//console.log("currentTabIndex : " + currentTabIndex);
		
		if(currentTabIndex !=2)
		{
			$("#tabs1").tabs("option", "active", currentTabIndex-1);
		}
	 
	 });	 
	 		  
	var c = 'popup';
    $.fn.editable.defaults.mode = c === 'inline' ? 'inline' : 'popup';					  
		  
});

	function loadAllClusterList(){
	
		countries =[];

		$.ajax({
		   url: 'http://'+(SERVER_IP)+':5984/devops/_design/cluster-query/_view/all',
		   type: 'get',
		   async: false,
		   dataType: 'json',
		   
		   success: function(data) {
	
				var rows = data.rows;
				
				for(i=0;i<rows.length;i++)
				{
					//console.log(rows[i].value.name);	
					var rowValue = rows[i].value._id +"-"+rows[i].value.name;
					countries.push({id: rowValue, text: rows[i].value.name});					
				}
			
		   },
					error: function(status) {
						console.log("Error in node-query/all : " + status);
					}
		});		
			
	
	}

	function loadAllNodesNew()
	{
		
			
		//console.log('http://localhost:5984/devops/_design/data/_view/by_hostname?startkey=%22'+(nodeName)+'%22&endkey=%22'+(nodeName)+'0%22');

			loadAllClusterList();	
		   //console.log("aaa11");
		   $.ajax({
		   url: 'http://'+(SERVER_IP)+':5984/devops/_design/node-query/_view/all',
		   type: 'get',
		   async: false,
		   dataType: 'json',
		   
		   success: function(data) {
	
				var rows = data.rows;
				
				for(i=0;i<rows.length;i++)
				{
					//console.log(rows[i].value.name);
					
					var jsonObject = rows[i];
					var jsonValue = rows[i].value;
					
					hostcluster_name="";
					getClusterName(jsonObject.key);
									
					//console.log("hostcluster_name : " + hostcluster_name);
					//console.log("hostnodemappingID : " + hostnodemappingID);
					
					if(i == rows.length-1)
					{
						$("#baseTable > tbody").append("<tr id='node"+(jsonValue._id)+"' hostname='"+(jsonObject.key)+"' nodemappingclusterid='"+(hostcluster_id)+"' nodemappingID='"+(hostnodemappingID)+"' align='center'><td class=\"rounded-foot-left\">"+(jsonObject.key)+"</td><td>"+(hostcluster_name)+"</td><td>"+(jsonValue.install_nic)+"</td><td>"+(jsonValue.install_ip)+"</td><td>"+(jsonValue.install_gw)+"</td><td>"+(jsonValue.install_nmask)+"</td><td><a id=\"aaaa\" href=\"javascript:editNode('"+(jsonValue._id)+"','"+(jsonValue._rev)+"');\"><img src=\"img/edit.png\"/></a></td><td class=\"rounded-foot-right\"><a id=\"aaaa\" href=\"javascript:deleteNode('"+(jsonValue._id)+"','"+(jsonValue._rev)+"');\"><img src=\"img/delete.png\"/></a></td></tr>");						
					}
					else
					{
						$("#baseTable > tbody").append("<tr id='node"+(jsonValue._id)+"' hostname='"+(jsonObject.key)+"'  nodemappingclusterid='"+(hostcluster_id)+"' nodemappingID='"+(hostnodemappingID)+"' align='center'><td>"+(jsonObject.key)+"</td><td>"+(hostcluster_name)+"</td><td>"+(jsonValue.install_nic)+"</td><td>"+(jsonValue.install_ip)+"</td><td>"+(jsonValue.install_gw)+"</td><td>"+(jsonValue.install_nmask)+"</td><td><a id=\"aaaa\" href=\"javascript:editNode('"+(jsonValue._id)+"','"+(jsonValue._rev)+"');\"><img src=\"img/edit.png\"/></a></td><td><a id=\"aaaa\" href=\"javascript:deleteNode('"+(jsonValue._id)+"','"+(jsonValue._rev)+"');\"><img src=\"img/delete.png\"/></a></td></tr>")						
					}
					
				}
				
				var rows = $('#baseTable tbody tr');
					
					//alert(rows.length);
					rows.each(function() {
					
					//console.log("ID ---- " + this.id);
					//console.log("hostnodemappingID ---- " + this.getAttribute("nodemappingID"));
					
					var nodeID = this.id.substr(4);
					var nodemappingID = this.getAttribute("nodemappingID");
					var clusterID = this.getAttribute("nodemappingclusterid");
					var hostname = this.getAttribute("hostname");
					
										
                    var td = $(this).find('td');
										 
					$(td.eq(1)).css( 'cursor', 'text' );					 
					$(td.eq(1)).attr( 'class', 'editable editable-click' );
					$(td.eq(1)).attr( 'data-type', 'select2' );
					$(td.eq(1)).attr( 'data-pk', '1' );
					$(td.eq(1)).attr( 'data-original-title', 'Select Cluster Name' );
					 
					$(td.eq(1)).editable({
						source: countries,
						select2: {
							width: 200
						} ,
						url: function(params) {

							//console.log("Changed to -> " + params.value);
							//console.log("Node ID -> " + nodeID);
							//console.log("Mapping ID -> " + nodemappingID);
							//console.log("Cluster ID -> " + clusterID);
							//console.log("Host Name -> " + hostname);
							
							
							var newClusterID   = params.value.substr(0,params.value.indexOf("-"));							
							var newClusterName = params.value.substr(params.value.indexOf("-")+1);							
							
							//console.log("newClusterName -> " + newClusterName);
							//console.log("newClusterID -> " + newClusterID);							
							
							if(nodemappingID!="")
							{
								$.couch.db("devops").openDoc(nodemappingID, {
								success: function(data) {
									
									var nodeMappingObject = data;
									
									nodeMappingObject['clusterid']=newClusterID;									
									nodeMappingObject['cluster_name']=newClusterName;									
									
									$.couch.db("devops").saveDoc(nodeMappingObject, {
										success: function(data) {
											alert("Saved");
										},
										error: function(status) {
											console.log("Error in Node - Cluster Save : " +status);
										}
									});	

								},
								error: function(status) {
									console.log(status);
								}	
								});
							}
							else
							{
							
								var jsonPayload = {};
								
								jsonPayload['type']='node-role-mapping';
								jsonPayload['clusterid']=newClusterID;
								jsonPayload['cluster_name']=newClusterName;			
								jsonPayload['hostname']=hostname.replace(/\./g,"-");
								
								var rolePayload = new Array();								
								
								jsonPayload['role']=rolePayload;	
								
								$.couch.db("devops").saveDoc(jsonPayload, {
									success: function(data) {
										alert("Saved");
									},
									error: function(status) {
										console.log("Error in Node Role Saving : " +status);
									}
								});	
							}
						},						
					}); 					
					
				});		
			
		   },
					error: function(status) {
						console.log("Error in node-query/all : " + status);
					}
		});		
		
	}

  $(document).ready(function() {
 
  loadAllNodesNew(); 
  isNew = true;
  console.log("isNew ---------> " + isNew);
  							
  $.getScript("/_utils/script/jquery.js?1.4.2", function(){
	$.getScript("/_utils/script/jquery.couch.js?0.11.0", function(){
		setTimeout(function() {chooseNodeMappingOptions(); }, 2000);		
 
				loadClusterList();
				//loadAllNodes();

					// fetch nodes
				$.couch.db("devops").view("node-query/all", {
					success: function(data) {					
						cloud_nodes = data;		
						//console.log("cloud_nodes : " + cloud_nodes);								
					},
					error: function(status) {
						console.log("Error in node-query/all : " + status);		
					},
					reduce: false
				});	
				

				$.couch.db("devops").view("chef-roles-query/all", {
					success: function(data) {
					
						chef_roles = data;		
						//console.log("chef_roles : " + chef_roles);		
						
					},
					error: function(status) {
						console.log("Error in chef-roles-query/all : " + status);		
					},
					reduce: false
				});	
				

		});
});				  
			

	  
	$('#tabs').tabs({ active: 0 });
	$('#tabs_main').tabs({ active: 0 });
	$('#tabs1').tabs({ active: 0 });
	
	setTimeout(function() {clearAll(); }, 2000);	
	
	$('#HAConfigurataion input:checkbox').change(function () {

		if(this.checked)
		{
			$('#row'+this.name).show();
			$('#'+this.name+"text").focus();
		}
		else
		{
			$('#row'+this.name).hide();	
		}
		
	});
	 $('#tabs-3 input:radio').change(function () {
			var selectedVal = $("#tabs-3 input:radio:checked").val();
			
			if(selectedVal=="New")
			{
				isNew=true;
				$("#selectOptionLabel").text("Create New Node");
				$('.newCluster').show();
				$('.existingNode').hide();
				chooseNodeMappingOptions();
				
			}
			else
			{
				isNew=false;
				$("#selectOptionLabel").text("Please Choose Node");
				$('.newCluster').hide();
				$('.existingNode').show();
				loadClusterConfiguration();
			}	
		
	 });
	 
	 $('#existingNodeSelect').change(function () {
			loadClusterConfiguration();
	 });
	 
	 
	 $('#networktype').change(function () {
		chooseNodeMappingOptions();
	  });

	 $('#deploymentSelectionSelect').change(function () {		
			chooseNodeMappingOptions();
	  });
	  
	


	 
	 
	  $("#resetCluster").click(function(e){
			clearAll();
	 });
	 
	 $("#haEnabledCheck").click(function(e){
			chooseNodeMappingOptions();
	 });
	 
	 $("#cleanCluster").click(function(e){
		// Save Info Tab
		//console.log("isNew : "+ isNew);	
		var cluster_name = loadedBaseObject['cluster_name'];
		cleanCluster(cluster_name);
	 });	 
	 
	 $("#startDeployment").click(function(e){
		
			// Save Info Tab
		console.log("isNew : "+ isNew);	
		if(isNew)
		{
		
			//console.log("oldID : " + oldID);
			//console.log("oldRevID : " + oldRevID);
			//console.log("oldClusterName : " + oldClusterName);
			
			if(oldID)
			{
				deleteCluster(oldID,oldRevID,oldClusterName,'No')
			}
			
			var jsonPayload = {};
			jsonPayload['type']='cluster';
			
			jsonPayload['ssh_key']='/root/.ssh/id_rsa';
			jsonPayload['user_name']='root';
			jsonPayload['chef_path']='/root/openstackchef/openstack-installation';
			jsonPayload['chef_env_name']=$("#name").val();
			jsonPayload['chef_server_ip']=SERVER_IP;
			
			var haEnabledCheck = $('input:checkbox[name=haEnabledCheck]:checked').val();
			
			if(!haEnabledCheck)
			{
					jsonPayload['deploymentSelection']=$('#deploymentSelectionSelect').val();
					jsonPayload['haEnabled']='false';
			}
			else
			{
					//jsonPayload['deploymentSelection']="";				
					jsonPayload['haEnabled']='true';
			}
			

					
			var rows = $('#newCluster input:text');
			for(i=0;i<rows.length;i++)
			{
				jsonPayload[rows[i].name]=rows[i].value;
			}
			
			var docID;
			$.couch.db("devops").saveDoc(jsonPayload, {
				success: function(data) {
					if(data.ok)
					{
						docID = data.id;
						
						oldID =  data.id;
						oldRevID = data.rev;
						oldClusterName = $("#name").val();		
						
						//console.log("docID : " +docID);
						//console.log("oldID : " +oldID);
						//console.log("oldRevID : " +oldRevID);
						//console.log("oldClusterName : " +oldClusterName);
						
						startTabSave(docID);
					}
				},
				error: function(status) {
					console.log("Error in saving cluser " + status);
				}
			});
		}
		else
		{
			//console.log("currentID : "+ currentID);	
			//console.log("currentRevID : "+ currentRevID);	
			
			if(currentID !=null)
			{	
				// Update Cluster Object				
				// delete loadClusterObject[nodeID];
				
				var haEnabledCheck = $('input:checkbox[name=haEnabledCheck]:checked').val();
			
				if(!haEnabledCheck)
				{
						loadClusterObject['deploymentSelection']=$('#deploymentSelectionSelect').val();
						loadClusterObject['haEnabled']='false';
				}
				else
				{
						if(loadClusterObject.deploymentSelection)
						{
							 delete loadClusterObject['deploymentSelection'];
						}
						loadClusterObject['haEnabled']='true';
				}
				
				$.couch.db("devops").saveDoc(loadClusterObject, {
					success: function(data) {
						//console.log(data.rev);
						loadClusterObject['_rev'] = data.rev;
					},
					error: function(status) {
						console.log("Error in Cluster Save : " +status);
					}
				});
				
				console.log("Cluster Saved");
				
				// Update Basic Object
				var basicObject1 = saveBasicConfigurationNew(currentID);	
			
				basicObject1['_id'] = loadedBaseObject['_id'];
				basicObject1['_rev'] = loadedBaseObject['_rev'];
				basicObject1['cluster_name'] = loadedBaseObject['cluster_name'];
				
				$.couch.db("devops").saveDoc(basicObject1, {
					success: function(data) {
						//console.log(data.rev);
						loadedBaseObject['_rev'] = data.rev;
					},
					error: function(status) {
						console.log("Error in Basic Configuration Save : " +status);
					}
				});
				
				console.log("Basic Configuration Saved");
				// Update HA Object
				
				
				var haEnabledCheck = $('input:checkbox[name=haEnabledCheck]:checked').val();
			
				var haObject1;
				
				if(haEnabledCheck)
				{
					haObject1 = saveHAConfigurationNew(currentID);	
					haObject1['cluster_name'] = loadedBaseObject['cluster_name'];
				}
				
				//console.log("loadedHAObject : "+ loadedHAObject);
				//console.log("haObject1 : "+ haObject1);
				
				if(loadedHAObject)
				{
					//console.log("loadedHAObject['_id'] " + loadedHAObject['_id']);
					
					if(!haObject1)
					{
						haObject1 = {};
					}
					
					haObject1['_id'] = loadedHAObject['_id'];
					haObject1['_rev'] = loadedHAObject['_rev'];
				}
				else
				{		
					//console.log("no present....New entry");
					
				}
					
				if(haEnabledCheck)
				{			
					//console.log("Saving HA Object");	
					$.couch.db("devops").saveDoc(haObject1, {
						success: function(data) {
							//console.log(data.rev);
							if(!loadedHAObject)
							{
								loadedHAObject=haObject1;
							}
							loadedHAObject['_rev'] = data.rev;
						},
						error: function(status) {
							console.log("Error in HA Save : " +status);
						}
					});				
				
				}
				else
				{
					if(haObject1)
					{
						console.log("Removing HA Object");
						$.couch.db("devops").removeDoc(haObject1, {
							success: function(data) {
								//console.log(data.rev);
								loadedHAObject="";
							},
							error: function(status) {
								console.log("Error in HA removal : " +status);
							}
						});										
					}
				}
				console.log("HA Configuration Saved");
				
				// Save Node Role Mapping
							
				var rows = $('#NodeMappingTable tr');
			
				rows.each(function() {
					
					var nodeID=this.id;
					//console.log("nodeID : " + nodeID);
					//console.log(nodeID);
					//console.log(loadedNodesObj[nodeID]);
					
					if(nodeID!="")
					{
						var oldnodeRoleObject1=loadedNodesObj[nodeID.replace(/\./g,"-")];
						
						//console.log("oldnodeRoleObject1 : " + oldnodeRoleObject1);
						
						var nodeRoleObject1 = saveNodeRoleMappingNew(currentID,nodeID);
						
						//cloudObj.push(nodeRoleObject);	
						
						//console.log("nodeRoleObject1 : " + nodeRoleObject1);
						
						if(nodeRoleObject1)
						{					
							if(oldnodeRoleObject1)
							{
								nodeRoleObject1['_id'] = oldnodeRoleObject1['_id'];
								nodeRoleObject1['_rev'] = oldnodeRoleObject1['_rev'];
							}
							
							nodeRoleObject1['cluster_name'] = loadedBaseObject['cluster_name'];
						
							$.couch.db("devops").saveDoc(nodeRoleObject1, {
								success: function(data) {
									//console.log(data.rev);
									oldnodeRoleObject1['_rev'] = data.rev;							
									loadedNodesObj[nodeID]=oldnodeRoleObject1;
								},
								error: function(status) {
									console.log("Error in Node Role Saving : " +status);
								}
							});					
						}
						else
						{					
							//console.log("Removing Node Role Mapping : "+ nodeID);
							
							if(oldnodeRoleObject1)
							{
								$.couch.db("devops").removeDoc(oldnodeRoleObject1, {
									success: function(data) {
										//console.log(data.rev);
										delete loadedNodesObj[nodeID];
									},
									error: function(status) {
										console.log("Error in Node Role Mapping removal : " +status);
									}
								});						
							}	
							
						}
					}
					
				});
				
				console.log("Node Role Mapping Saved");
				
				// Start Deployment
				
				startDeployment(loadedBaseObject['cluster_name']);
				
				
			}
		}
			
	  });
	  
	  	  
	  
	  function startTabSave(docID)
	  {
			console.log("Entering startTabSave with docID : " + docID);
			if(docID !=null)
			{
				var cloudObj = [];

				var basicObject = saveBasicConfigurationNew(docID);		
				cloudObj.push(basicObject);
				
				var haEnabledCheck = $('input:checkbox[name=haEnabledCheck]:checked').val();
				if(haEnabledCheck)
				{
					var haObject = saveHAConfigurationNew(docID);	
					cloudObj.push(haObject);					
				}	
				var rows = $('#NodeMappingTable tr');
				
				rows.each(function() {
				
				if(this.id)
				{
					var nodeRoleObject = saveNodeRoleMappingNew(docID,this.id);
					
					//console.log("nodeRoleObject " + nodeRoleObject);
					
					if(nodeRoleObject!="")
					{
						cloudObj.push(nodeRoleObject);	
					}
				}
				});
				
				//console.log("Entering startTabSave 2");				
				$.couch.db("devops").bulkSave({"docs": cloudObj}, {
					success: function(data) {
						startDeployment($("#name").val());
					},
					error: function(status) {
						console.log("Error in document save : " + status);
					}
				});
					
				
			}
	  }
	  
	   function saveNodeRoleMappingNew(id,rowid) {
 
		console.log("Entering saveNodeRoleMappingNew with id : " + id+ ", rowid : " + rowid );
		var nodeName = rowid;
		
		//console.log("NodeName : -----------------> " + nodeName);
		//console.log("NodeName : -----------------> " + nodeName.replace(/\./g,"\\."));
		
		
		var rows1 = $("#"+(rowid)+" input:checkbox");
			//alert(rows1.length);
			
		var jsonPayload = {};
		jsonPayload['type']='node-role-mapping';
		jsonPayload['clusterid']=id;
		jsonPayload['cluster_name']=$("#name").val();			
		jsonPayload['hostname']=nodeName.replace(/-/g,"\.");
		
		var rolePayload = new Array();
		
		//console.log("rows1.length " + rows1.length);
		

			for(i=0;i<rows1.length;i++)
			{
				//console.log("rows1[i].name " + rows1[i].name);
				
				var isEnabledCheck = $("input:checkbox[name='"+(rows1[i].name)+"']:checked").val();
				
				//console.log("isEnabledCheck " + isEnabledCheck);
				if(isEnabledCheck)
				{
					rolePayload.push(rows1[i].value);
				}				
			}			
			//console.log("rolePayload : " + rolePayload);
			//console.log("rolePayload.size : " + rolePayload.size);
			if(rolePayload!="")
			{			
				jsonPayload['role']=rolePayload;						
				return jsonPayload;
			}
			else
			{
				return "";
			}
  }
	  
	   function saveHAConfigurationNew(id) {
 
		//alert(id);
	
		var jsonPayload = {};
		jsonPayload['type']='cluster-ha-setting';
		jsonPayload['clusterid']=id;
		jsonPayload['cluster_name']=$("#name").val();
		
		jsonPayload['hatype']=$("#hatype").val();


			var rows = $('#loadBalancer select');
			for(i=0;i<rows .length;i++)
			{
				jsonPayload[rows[i].name]=rows[i].value;
			}		

			var rows = $('#HAConfigurataion input:checkbox');
			//alert(rows.length);
			
			var haPayload = {};
			var vipsPayload = {};
			
			for(i=0;i<rows.length;i++)
			{
				var isEnabledCheck = $('input:checkbox[name='+(rows[i].name)+']:checked').val();
				if(isEnabledCheck)
				{
					haPayload[rows[i].name+"_ha"]=isEnabledCheck;
					vipsPayload[rows[i].name+"_vip"]=$("#"+rows[i].name+"text").val();
					
					if(rows[i].name=='db')
					{
						var dbPayload = {};
						dbPayload['db2_primary_host']=$("#dbtext1").val();
						dbPayload['db2_standby_host']=$("#dbtext2").val();
						
						jsonPayload['db']=dbPayload;
					}
					
					if(rows[i].name=='mq')
					{
						var mqPayload = {};
						mqPayload['qpid_nodes']=$("#mqtext1").val()+","+$("#mqtext2").val();
						
						jsonPayload['mq']=mqPayload;
					}					
				}
				else
				{
					haPayload[rows[i].name+"_ha"]='false';
					vipsPayload[rows[i].name+"_vip"]="0.0.0.0";
				}
			}				
						
			jsonPayload['ha']=haPayload;
			jsonPayload['vips']=vipsPayload;
			
			return jsonPayload;

    }
	  
	   function saveBasicConfigurationNew(id) {
 

		var jsonPayload = {};
		jsonPayload['type']='cluster-basic-setting';
		jsonPayload['clusterid']=id;
		//console.log("name : " + $("#name").val());
		jsonPayload['cluster_name']=$("#name").val();


		var rows = $('#basicConfiguration select');
		for(i=0;i<rows .length;i++)
		{
			jsonPayload[rows[i].name]=rows[i].value;
		}

		if($("#networktype").val() == 'quantum')
		{
		
			var quantumPayload = {};			
			var rows = $('#Quantum input:text');

			for(i=0;i<rows .length;i++)
			{
				quantumPayload[rows[i].name]=rows[i].value;
			}
	
			/*var rows1 = $('#Quantum input:radio');
			
			console.log("rows : " + rows1.length);
			
			for(i=0;i<rows1.length;i++)
			{
				console.log("Radio : " + rows1[i].name);
				console.log("Radio : " + rows1[i].value);
				quantumPayload[rows[i].name]=rows1[i].value;
			}*/
			
			//var selectedVal = $("#enableTuneling").val();
			
			var selectedVal = $('input[name=enable_tunneling]:radio:checked').val();
			//console.log("selectedVal : " + selectedVal);
			
			quantumPayload['enable_tunneling']=selectedVal;
			
			jsonPayload['quantum']=quantumPayload;
		}

		
		var networksPayload = {};
		
		var rows = $('#OSOPS input:text');

		for(i=0;i<rows .length;i++)
		{
			networksPayload[rows[i].name]=rows[i].value;
		}
		
		networksPayload['dns1']="172.16.0.1";
		networksPayload['bridge']="br-vmnet";
		networksPayload['bridgedev']="eth1";
		networksPayload['vmnet']="192.168.1.0/24";
		networksPayload['vmnetnum']="1";
		networksPayload['vmnetsize']="256";
		networksPayload['firewall_driver']="nova.virt.firewall.NoopFirewallDriver";
		networksPayload['network_manager']="nova.network.manager.FlatDHCPManager";
		
		var vlanPayload = {};
		vlanPayload['vlan_start']="520";
		vlanPayload['vlan_end']="550";
		vlanPayload['vlan_interface']="vlan1";
		networksPayload['vlan']=vlanPayload;
		
		jsonPayload['networks']=networksPayload;
		
				
		var glancePayload = {};
		var image_upload = $('input:radio[name=image_upload]:checked').val();
		glancePayload['image_upload']=image_upload;		
		jsonPayload['glance']=glancePayload;

		var gpfsPayload = {};
		gpfsPayload['gpfs_cluster_name']="gpfs_01";
		jsonPayload['gpfs']=gpfsPayload;
		
		jsonPayload['enable_iptables']='true';
		jsonPayload['packageserver']=SERVER_IP;
		jsonPayload['imageserver']=SERVER_IP;
	
		return jsonPayload;
		
    }
	  
 
  });	
	
	function startDeployment(cluster_name)
	  {
		// Save Info Tab
		var jsonPayload = {};
		jsonPayload['type']='action';
		jsonPayload['user_request']='deployment'; 
		jsonPayload['status']='start'; //Four status: start, running, end, failed
		jsonPayload['cluster_name']=cluster_name;
		jsonPayload['user_name']='root';
		
		var rows = $('#newCluster input:text');
		for(i=0;i<rows.length;i++)
		{
			jsonPayload[rows[i].name]=rows[i].value;
		}
		

		$.couch.db("devops").saveDoc(jsonPayload, {
			success: function(data) {
				if(data.ok)
				{
					//console.log("action : " + data.rev);
					alert("Deployment<" + cluster_name +"> request sent!");
                                        $("#startDeployment").attr('disabled', true);
                                        $("#cleanCluster").attr('disabled', true); 
					//clearAll();
					//$("#baseTableCluster  > tbody").empty();	
					showDeploymentProgress();
					loadClusterList();
					loadAllNodesNew();
				}
			},
			error: function(status) {
			console.log("Error in Deployment request " + status);
			}
		});
			
	  }

	  	function cleanCluster(cluster_name)
	  {
		// Save Info Tab
		var jsonPayload = {};
		jsonPayload['type']='action';
		jsonPayload['user_request']='clean';	
		jsonPayload['status']='start'; //Four status: start, running, end, failed
		jsonPayload['cluster_name']=cluster_name;
		jsonPayload['user_name']='root';
		
		var rows = $('#newCluster input:text');
		for(i=0;i<rows.length;i++)
		{
			jsonPayload[rows[i].name]=rows[i].value;
		}
		

		$.couch.db("devops").saveDoc(jsonPayload, {
			success: function(data) {
				if(data.ok)
				{
					//console.log("action : " + data.rev);
					alert("Clean<" + cluster_name +"> request sent!");
					//clearAll();
					showCleanLogs();
					loadClusterList();
				}
			},
			error: function(status) {
			console.log("Error in Deployment request " + status);
			}
		});
			
	  }

	function showDeploymentProgress()
	  {
		clearInterval(cleanLogShowInterval);
		$('#progress').html("Start preparing chef cookbooks and roles....");
		progressLogShowInterval = setInterval(function() {
		  
		  $.ajax({type:'GET', 
				  url: 'http://' + SERVER_IP + ':5984/devops/progress-log/detail.log',     		
				  success: function(response) { 
				  if(response)
				  {	
					var obj = JSON.parse(response);
  					var progress_html = "<table><tr>";  

					/*		
					progress_html += "<tr>";
					for (var key in obj) {
					  if (obj.hasOwnProperty(key)) {
					     progress_html += "<td>";
					     progress_html += key;
					     progress_html += "</td>"
					  }
					}
					progress_html += "</tr>"
					*/
					
					for (var key in obj) {
					  if (obj.hasOwnProperty(key)) {
						var role_progresses = obj[key];	
						progress_html += "<td valign=\"top\"><table class=\"roundTable\"><tr><th>Node</th><th>Component</th><th>Status</th></tr>";
						progress_html += "<tr>";
						progress_html += "<td valign=\"top\" rowspan=\"" + role_progresses.length + "\">";
						progress_html += "<b>" + key + "</b>";
						progress_html += "</td>"

						for (var i=0; i<role_progresses.length; i++) {

							//alert(JSON.stringify(role_progresses[i]));
							for (var key1 in role_progresses[i]) {
					  			if (role_progresses[i].hasOwnProperty(key1)) {
									var current_status = role_progresses[i][key1];

									if(i>0) progress_html += "<tr>";
					   				progress_html += "<td>";
					   				progress_html += key1;
					   				progress_html += "</td><td>";
									if(current_status=="installing")
										progress_html += "<img src=\"installing.gif\" alt=\"Installing\" width=\"30\" height=\"30\">";
									else if(current_status=="installed")
										progress_html += "<img src=\"installed.png\" alt=\"Installed\" width=\"30\" height=\"30\">";
									else if(current_status=="pending")
										progress_html += "Pending";
					   				progress_html += "</td></tr>";
									
									
									if(key1=="quantum-ovs-agent" && current_status=="installed") {
  										$('#horizonadmin').html("<h3 align=\"center\">Deployment completed, please access the OpenStack Dashboard <a href=\"http://172.16.1.31\">here</a>.</h3>");
										$("#startDeployment").removeAttr("disabled");
										$("#cleanCluster").removeAttr("disabled");
									
									} else {
  										$('#horizonadmin').html("<h3 align=\"center\">Deployment in progress...</h3>");
									}

  									//$('#horizonadmin').removeAttr("disabled");
								}
							}

						   	//progress_html += role_progresses[i];
						}
						if (role_progresses.length <=0) progress_html += "</tr>";
						progress_html += "</td></table>";
					  }
					}

  					progress_html += "</tr></table>";  


					//alert(progress_html);
					//$('#progress').html(JSON.stringify(object));
					$('#progress').html(progress_html);

					tailScroll();
				  }
			 },
			 error: function(jqXHR, textStatus, errorThrown) {
		  		// alert("Some Error has occurred.");
			 }   			 
			 }); 

			
		}, 4000 );
	  }
	  
	function showDeploymentLogs()
	  {
		clearInterval(cleanLogShowInterval);
		$('#result').val("Start preparing chef cookbooks and roles....");
		deploymentLogShowInterval = setInterval(function() {
		  
		  $.ajax({type:'GET', 
				  url: 'http://' + SERVER_IP + ':5984/devops/deployment-log/detail.log',     		
				  success: function(response) { 
				  if(response)
				  {	
					//alert(response);
					//$('#result').append(response);
					$('#result').val(response);
					var index = response.indexOf("Total Deployment Finished");
					if (index >=0) {
						clearInterval(deploymentLogShowInterval);
						//$('#result').val("OpenStack Deployment is successfully accomplished!");
  						$('#horizonadmin').show();	
					}
					tailScroll();
				  }
			 },
			 error: function(jqXHR, textStatus, errorThrown) {
		  		// alert("Some Error has occurred.");
			 }   			 
			 }); 

			
		}, 4000 );
	  }
	  
	  function showCleanLogs()
	  {
		clearInterval(deploymentLogShowInterval);
		$('#result').val("Start preparing cluster cleanup....");
		cleanLogShowInterval = setInterval(function() {
		  
		  $.ajax({type:'GET', 
				  url: 'http://' + SERVER_IP + ':5984/devops/clean-log/detail.log',     		
				  success: function(response) { 
				  // alert(response);
				  if(response)
				  {	
					//$('#result').append("\n"+response);
					$('#result').val("\n"+response);
					//alert(response);
					
					var index = response.indexOf("Total Cleanup Finished");
					if (index >=0) {
						clearInterval(cleanLogShowInterval);
						//$('#result').append("OpenStack Cleanup is successfully accomplished!");
					}
					tailScroll();
				  }
			 },
			 error: function(jqXHR, textStatus, errorThrown) {
		  		// alert("Some Error has occurred.");
			 }   			 
			 }); 

			
		}, 4000 );
	  }
    
	  function tailScroll() {
		  var height = $("#result").get(0).scrollHeight;
		  $("#result").animate({
			  scrollTop: height
		  }, 500);
	  }
	  
	
	function loadClusterConfiguration()
	{
	
		var currentCluster = $("#existingNodeSelect").val();
		currentID = currentCluster;
		

		loadedNodesObj ={};	
		
		//console.log("currentCluster : " + currentCluster);
		//alert(currentCluster);	
		
		$.couch.db("devops").openDoc(currentCluster, {
		success: function(data) {
		
		
			loadClusterObject = data;
			//console.log("data : " + data);
			//console.log("data.deploymentSelection : " + data.deploymentSelection);
			
			currentRevID = data._rev;
			
			if(data.deploymentSelection)
			{
				$('#haEnabledCheck').attr('checked', false);
				$('#deploymentSelectionSelect').val(data.deploymentSelection);								
			}
			else
			{
				$('#haEnabledCheck').attr('checked', 'checked');
			}
			
			chooseNodeMappingOptions();
				
		},
		error: function(status) {
			console.log(status);
		}	
		});
	
	
	$.couch.db("devops").view("data/by_clusterid", { key: currentCluster, success: function(data) {

					var nodes = data.rows;
					//console.log("nodes length : " + nodes.length);
	
					for(nodeI=0;nodeI<nodes.length;nodeI++)
					{
						var jsonObject = nodes[nodeI];
						//alert(jsonObject);
						var jsonValue = jsonObject.value;
						
						//alert(jsonValue.type);
						if(jsonValue.type == "cluster-basic-setting")
						{
							//console.log("Loading Basic Object");
							loadedBaseObject = jsonValue;
							var rows = $('#basicConfiguration select');
							for(i=0;i<rows.length;i++)
							{
								$('#'+(rows[i].name)).val(jsonValue[rows[i].name]);
								
								if(jsonValue[rows[i].name] =="quantum")
								{
									$('.Quantum').show();		
									var quantumObj = jsonValue['quantum'];
									
									var input_rows = $('#Quantum input:text');
									for(j=0;j<input_rows.length;j++)
									{
										$('#'+(input_rows[j].name)).val(quantumObj[input_rows[j].name]);
									}
									
									//alert(quantumObj['enable_tunneling']);
									if(quantumObj['enable_tunneling'] == 'true')
									{
										$('input:radio[name=enable_tunneling]:nth(0)').attr('checked',true);
									}
									else
									{
										$('input:radio[name=enable_tunneling]:nth(1)').attr('checked',true);
									}
									
								}
								else
								{
									$('.Quantum').hide();	
								}															
							}
						
							var networksObj = jsonValue['networks'];
							
							var rows = $('#OSOPS input:text');

							for(k=0;k<rows.length;k++)
							{
								$('#'+(rows[k].name)).val(networksObj[rows[k].name]);
							}								
							
							var glanceOjb = jsonValue['glance'];
							
							if(glanceOjb['image_upload'] == 'true')
							{
								$('input:radio[name=image_upload]:nth(0)').attr('checked',true);
							}
							else
							{
								$('input:radio[name=image_upload]:nth(1)').attr('checked',true);
							}							
							
						}
						else if(jsonValue.type == "cluster-ha-setting")
						{
							//console.log("Loading HA Object");
							loadedHAObject=jsonValue;
							
							$('#haEnabledCheck').attr('checked', 'checked');		
							//console.log("HA Enabled Checked");		
							$('.loadBalancer').show();	

							//chooseNodeMappingOptions();
							//console.log("Proceeding");

							$('#hatype').val(jsonValue['hatype']);
							
							var haObj = jsonValue['ha'];
							var vipsObj = jsonValue['vips'];

							var all_keys = Object.keys(haObj);
													
							for (var j in all_keys) {
								var value = haObj[all_keys[j]];
								//alert(value);
								
								if(value == 'true')
								{									
									//alert(all_keys[j].indexOf("_ha"));
									
									var objName = 	all_keys[j].substr(0,all_keys[j].indexOf("_ha"));
									//alert(objName);									
									$('#'+objName+'').attr('checked', 'checked');
									$('#row'+objName).show();

									$('#'+(objName)+'text').val(vipsObj[objName+"_vip"]);
									
									if(objName=="db")
									{
										var dbObj = jsonValue['db'];
										
										$('#dbtext1').val(dbObj['db2_primary_host']);			
										$('#dbtext2').val(dbObj['db2_standby_host']);			
																				
									}
									else if(objName=="mq")
									{
									
										var mqObj = jsonValue['mq'];
										var qpid_nodes = mqObj['qpid_nodes'];
										
										$('#mqtext1').val(qpid_nodes.substr(0,qpid_nodes.indexOf(",")));			
										$('#mqtext2').val(qpid_nodes.substr(qpid_nodes.indexOf(",")+1));										
									
									}
								}
								
							}
						
						}
						else if(jsonValue.type == "node-role-mapping")
						{
							console.log("Loading Node Role Mapping Object for : " + jsonValue['hostname'].replace(/\./g,"-"));
							loadedNodesObj[jsonValue['hostname'].replace(/\./g,"-")] =jsonValue;
							//console.log("node");
							var rows = $('#'+jsonValue['hostname'].replace(/\./g,"-"));						
							//console.log("rows.length : -> " + rows.length);
							if(rows.length !=0)
							{
									var roleObj = jsonValue['role'];
								
									var roles=String(roleObj).split(",");
									//alert(roles);
									//console.log(roles);
									
									for (var j in roles) {
										//console.log('#'+jsonValue['hostname'].replace(/\./g,"-")+roles[j]+'');
										$('#'+jsonValue['hostname'].replace(/\./g,"-")+roles[j]+'').attr('checked', 'checked');										
									}										
							}	
							
						}
					}
					
					//chooseNodeMappingOptions();
					
					// show only node rols in mapping which are needed
					
					hideNodeMappingRows(loadedNodesObj);
			
					} } )	
		
	

	}
	  function hideNodeMappingRows(loadedNodesObjNew){
	  
			//alert("here");

			var rows = $('#NodeMappingTable tbody tr');
			
			console.log(rows.length);
			for(i=0;i<rows.length;i++)
			{
				//jsonPayload[rows[i].name]=rows[i].value;
				var currentlROWID = rows[i].id;
				
				var oldnodeRoleObject1=loadedNodesObjNew[currentlROWID.replace(/\./g,"-")];
				console.log(oldnodeRoleObject1);
				
				if(!oldnodeRoleObject1)
				{
					$('#'+currentlROWID).hide(); 
				}
				
			}
			
			
			
			
		
		}
	  function chooseNodeMappingOptions(){
	  
		// Check Network Type
		console.log("inside chooseNodeMappingOptions");
		var network_type = $('#networktype').val();
		console.log("network_type : " + network_type);
						
		if(network_type=="quantum")
		{
			$('.Quantum').show();				
		}
		else
		{
			$('.Quantum').hide();	
		}		
		
		// Check Whether HA enabled or not
		
		var isHAEnabled = $('#haEnabledCheck:checked').val()?true:false;
		console.log("isHAEnabled : " + isHAEnabled);
		if(isHAEnabled)
		{
			$('.loadBalancer').show();	
			$('#deploymentSelection').hide();	
			showNodeMappingTable("HA","all-"+network_type);			
			console.log("showNodeMappingTable with HA All : " );
		}
		else
		{
			$('.loadBalancer').hide();
			$('#deploymentSelection').show();	
			$("#NodeMappingTable").empty();
			
			var deploymentOption = $('#deploymentSelectionSelect').val();
			console.log("showNodeMappingTable with NoHA : " + deploymentOption );
			if(deploymentOption!="all")
			{
				showNodeMappingTable("NONHA",deploymentOption+"-"+network_type);
			}
			else
			{
				showNodeMappingTable("NONHA",deploymentOption);
			}					

			console.log("isNew -> " + isNew);	

			if(!isNew)
			{
				if(Object.keys(loadedNodesObj).length!=0)
				{
					console.log("here " + Object.keys(loadedNodesObj).length);
					hideNodeMappingRows(loadedNodesObj);
				}
			}
			
		}	

		
	  }


	  
	  function showNodeMappingTable(hanonha,options) {
	 			
				
				var nodes = chef_roles.rows;
				var jsonObject = nodes[0];
				var jsonValue = jsonObject.value;
				var hanonhaObject = jsonValue[hanonha];
				var nonhaObject = hanonhaObject[options];	
				var all_keys = Object.keys(nonhaObject);
				
				var tableStr="";
				tableStr = tableStr.concat("<TR align=\"center\">");
				tableStr = tableStr.concat("<TH class=\"rounded-left\" align=\"center\" width=\"10%\">Node Name</TH>");
				for (var j in all_keys) {
					var value = nonhaObject[all_keys[j]];
					
					if(j ==all_keys.length-1)
					{
						tableStr = tableStr.concat("<TH class=\"rounded-right\" align=\"center\" width=\"10%\">");
					}
					else
					{
						tableStr = tableStr.concat("<TH  align=\"center\" width=\"10%\">");
					}
					tableStr = tableStr.concat(value);
					tableStr = tableStr.concat("</TH>");
				}
				tableStr = tableStr.concat("</TR>");
					
				//alert(tableStr);
				$("#NodeMappingTable").empty();
				$("#NodeMappingTable").append(tableStr);
				var tableStr="";
				
						var nodes = cloud_nodes.rows;

						for(i=0;i<nodes.length;i++)
						{
							var jsonObject = nodes[i];						
							tableStr = tableStr.concat("<TR id=\""+(jsonObject.key.replace(/\./g,"-"))+"\" align=\"center\">");
							
							if(i ==nodes.length-1)
							{
								tableStr = tableStr.concat("<TD class=\"rounded-foot-left\" align=\"center\" >");
							}
							else
							{							
								tableStr = tableStr.concat("<TD align=\"center\" >");	
							}
								tableStr = tableStr.concat(jsonObject.key);
								tableStr = tableStr.concat("</TD>");							
							
							
							for (var j in all_keys) {
								var value = nonhaObject[all_keys[j]];
							
								//console.log("j : " + j);
								//console.log("all_keys : " + all_keys.length);

								if(i ==nodes.length-1 && j ==all_keys.length-1)
								{
									tableStr = tableStr.concat("<TD class=\"rounded-foot-right\" align=\"center\" >");	
								}
								else
								{
									tableStr = tableStr.concat("<TD  align=\"center\" >");	
								}
								
								tableStr = tableStr.concat("<input id=\""+(jsonObject.key.replace(/\./g,"-"))+(value)+"\" name=\""+(jsonObject.key.replace(/\./g,"-"))+(value)+"\" value=\""+(value)+"\" type=\"checkbox\">");
								tableStr = tableStr.concat("</TD>");
							}
							tableStr = tableStr.concat("</TR>");			
						}	
						
						$("#NodeMappingTable").append(tableStr);
					 	  
	  }	  


function deleteNode(id,revID) {
 
var jsonPayload = {};
jsonPayload['_id']=id;
jsonPayload['_rev']=revID;
 
$.couch.db("devops").removeDoc(jsonPayload, {
     success: function(data) {
         if(data.ok)
		{
			alert("Node Deleted");
			//location.reload(true);
			$('#node' + id).remove();
		}
    },
    error: function(status) {
        console.log("Error in Delete Node : " + status);
    }
});

    }

	
function deleteCluster1(id,revID) {

var docs = [
    {
        _id: "8065ab7678ff8cea85461329ea08c960",
        _rev: "1-e13b674afb51e1b55fd4757fb50cf5d1"
    },
    {
        _id: "8065ab7678ff8cea85461329ea0a03c9",
        _rev: "1-e13b674afb51e1b55fd4757fb50cf5d1"
    }
];
$.couch.db("devops").bulkRemove({"docs": docs}, {
    success: function(data) {
        console.log(data);
    },
    error: function(status) {
        console.log(status);
    }
});

}	
	
function deleteCluster(id,revID,cluster_name,showAlert) {

//var delCloudObj = [];
var jsonPayload = {};

console.log("here");

jsonPayload['_id']=id;
jsonPayload['_rev']=revID;

console.log("Delete Cluster _id : " + id);
console.log("Delete Cluster _rev : " + revID);
 
		$.couch.db("devops").removeDoc(jsonPayload, {
			success: function(data) {
				console.log("data : "+ data);

    },
    error: function(status) {
        console.log("Error in Cluster Delete : " + status);
    }
});
//delCloudObj.push(jsonPayload);

 //console.log("Deleting Child nodes Before");
 $.couch.db("devops").view("data/by_clusterid", { key: id, success: function(data) {

	var nodes = data.rows;
	
	//console.log("Deleting Child nodes");
	for(nodeI=0;nodeI<nodes.length;nodeI++)
	{
		var jsonObject = nodes[nodeI];
		//alert(jsonObject);
		var jsonValue = jsonObject.value;
		
		jsonPayload['_id']=jsonValue['_id'];
		jsonPayload['_rev']=jsonValue['_rev'];
		
		//delCloudObj.push({_id: jsonValue['_id'], _rev: jsonValue['_rev']});
		
		$.couch.db("devops").removeDoc(jsonPayload, {
			success: function(data) {
				//console.log("data 1 : "+ data);

    },
    error: function(status) {
        console.log("Error in removing cluster : " + status);
    }
});
		
	}
				if(showAlert =='Yes')
				{
					alert("Cluster Deleted");
				}
				$('#cluster' + id).remove();
				
				setTimeout(function() {populateClusterList(); }, 2000);	
				loadClusterList();
				loadAllNodesNew();
				
				
				//var cluster_name = loadedBaseObject['cluster_name'];
				//cleanCluster(cluster_name);				
	

 },
    error: function(status) {
        console.log("Error in data/by_clusterid : " + status);
    }
});

/*$.couch.db("devops").bulkRemove({"docs": delCloudObj}, {
     success: function(data) {
	 console.log("data : "+ data);
	alert("Cluster Deleted");
	$('#cluster' + id).remove();
	loadClusterList();
    },
    error: function(status) {
        alert(status);
    }
});*/

    }
	
	function removeNode()
	{
		$('#newNode').remove();
	}

	function createNode()
	{
		
	$("#baseTable > tbody").append("<tr id=\"newNode\" align='center'><td><input name=\"name\" id=\"name\" type=\"text\"></td><td><input name=\"install_nic\" id=\"install_nic\"  type=\"text\"></td><td><input name=\"install_ip\" id=\"install_ip\" type=\"text\"></td><td><input name=\"install_gw\" id=\"install_gw\" type=\"text\"></td><td><input name=\"install_nmask\" id=\"install_nmask\" type=\"text\"></td><td><img id=\"addNode\" src=\"img/add.png\"/></a></td><td><a href=\"javascript:removeNode();\"><img src=\"img/delete.png\"/></a></td></tr>");
	
		$('#name').focus();
		
			$("#addNode").click(function(e){
			
			var jsonPayload = {};
			jsonPayload['type']='node';
			
			var rows = $('#create_node input:text');
			for(i=0;i<rows .length;i++)
			{
				jsonPayload[rows[i].name]=rows[i].value;
			}
			$.couch.db("devops").saveDoc(jsonPayload, {
				success: function(data) {
					if(data.ok)
					{
						alert("Node Saved");
						location.reload(true);
						// loadAllNodes();
						
						//$("#baseTable > tbody").append("<tr id='"+(jsonValue._id)+"' align='center'><td>"+(jsonObject.key)+"</td><td>"+(jsonValue.install_nic)+"</td><td>"+(jsonValue.install_ip)+"</td><td>"+(jsonValue.install_gw)+"</td><td>"+(jsonValue.install_nmask)+"</td><td><a id=\"aaaa\" href=\"javascript:deleteNode('"+(jsonValue._id)+"','"+(jsonValue._rev)+"');\">Delete</a></td></tr>");
					}
				},
				error: function(status) {
					console.log("Error in Creating Node : " + status);
				}
			});
		});			
	}

	
	function editNode(id,revID) {
		
		var rows = $('#baseTable tr');
			
		var tws = $("#node"+(id));	
		var tds = $("#node"+(id)+" td");
			
		$(tws).html("<td><input name=\"name\" size=\"10\" id=\"name\" type=\"text\" value=\""+(tds[0].innerHTML)+"\"></td><td><input name=\"install_nic\" size=\"10\" id=\"install_nic\"  type=\"text\" size=\"10\" value=\""+(tds[1].innerHTML)+"\"></td><td><input name=\"install_ip\" id=\"install_ip\" size=\"10\" type=\"text\"  value=\""+(tds[2].innerHTML)+"\"></td><td><input size=\"10\" name=\"install_gw\" id=\"install_gw\" type=\"text\" value=\""+(tds[3].innerHTML)+"\"></td><td><input name=\"install_nmask\" size=\"10\" id=\"install_nmask\" type=\"text\" value=\""+(tds[4].innerHTML)+"\"></td><td><img id=\"addNode\" src=\"img/add.png\"/></a></td><td>&nbsp;</td>");	

					$("#addNode").click(function(e){
					
					var jsonPayload = {};
					
					jsonPayload['type']='node';
					jsonPayload['_id'] = id;
					jsonPayload['_rev'] = revID;						
					
					var rows = $('#create_node input:text');
					for(i=0;i<rows .length;i++)
					{
						jsonPayload[rows[i].name]=rows[i].value;
					}
					$.couch.db("devops").saveDoc(jsonPayload, {
						success: function(data) {
						
							
							if(data.ok)
							{								
								$(tws).html("<td class=\"rounded-foot-left\">"+(jsonPayload['name'])+"</td><td>"+(jsonPayload['install_nic'])+"</td><td>"+(jsonPayload['install_ip'])+"</td><td>"+(jsonPayload['install_gw'])+"</td><td>"+(jsonPayload['install_nmask'])+"</td><td><a id=\"aaaa\" href=\"javascript:editNode('"+(id)+"','"+(data.rev)+"');\"><img src=\"img/edit.png\"/></a></td><td class=\"rounded-foot-right\"><a id=\"aaaa\" href=\"javascript:deleteNode('"+(id)+"','"+(data.rev)+"');\"><img src=\"img/delete.png\"/></a></td>");
							}
						},
						error: function(status) {
							console.log("Error in Updating Node : " + status);
						}
					});
				});	
			
					
	}
	
	var hostcluster_id;
	var hostcluster_name;
	var hostnodemappingID;
	
	
	function getClusterName(nodeNameOld)
	{
	
	var nodeName = nodeNameOld.replace(/\-/g,".");
	
	//console.log('http://localhost:5984/devops/_design/data/_view/by_hostname?startkey=%22'+(nodeName)+'%22&endkey=%22'+(nodeName)+'0%22');
		
	$.ajax({
   url: 'http://'+(SERVER_IP)+':5984/devops/_design/data/_view/by_hostname?startkey=%22'+(nodeName)+'%22&endkey=%22'+(nodeName)+'0%22',
   type: 'get',
   async: false,
   dataType: 'json',
   
   success: function(data) {

		//console.log(data.rows.length);
		if(data.rows.length>0)
		{
			
			//console.log("Cluster Name - " + data.rows[0].value.cluster_name);
			//console.log("Cluster ID - " + data.rows[0].value._id);
			
			hostcluster_id = data.rows[0].value.clusterid;
			hostcluster_name = data.rows[0].value.cluster_name;
			hostnodemappingID = data.rows[0].value._id;
		}
		else
		{
			hostcluster_name ="";
			hostcluster_id="";
			hostnodemappingID="";
		}
   },
			error: function(status) {
				console.log("Error in node-query/all : " + status);
			}
});
	}
	function getClusterName1(nodeName)
	{
			$.couch.db("devops").view("data/by_hostname", { key: nodeName, success: function(data) {

			var nodes_hosts = data.rows;
			//console.log("nodes_hosts length : " + nodes_hosts.length);
			
			if(nodes_hosts.length >0)
			{
				var jsonObjectHost = nodes_hosts[0];
				
				console.log(jsonObjectHost.value.cluster_name);
				hostcluster_name = jsonObjectHost.value.cluster_name;
				
			}

			} } )	
		
		//console.log("returned");		
		return "aniruddha "+ nodeName;
	}


	
	function loadAllNodes()
	{
		
		$.couch.db("devops").view("node-query/all", {

			success: function(data) {
								
				//$("#baseTable").empty();
				
				$("#baseTable  > tbody > tr").empty();	
				var nodes = data.rows;
				for(i=0;i<nodes.length;i++)
				//for(i=0;i<2;i++)
				{
					var jsonObject = nodes[i];
					var jsonValue = jsonObject.value;
					
					//console.log("Key ->>>>> " + jsonObject.key);
					
					hostcluster_name="";
					getClusterName(jsonObject.key);
									
					//console.log("hostcluster_name : " + hostcluster_name);
					
					if(i == nodes.length-1)
					{
						$("#baseTable > tbody").append("<tr id='node"+(jsonValue._id)+"' align='center'><td class=\"rounded-foot-left\">"+(jsonObject.key)+"</td><td>"+(hostcluster_name)+"</td><td>"+(jsonValue.install_nic)+"</td><td>"+(jsonValue.install_ip)+"</td><td>"+(jsonValue.install_gw)+"</td><td>"+(jsonValue.install_nmask)+"</td><td><a id=\"aaaa\" href=\"javascript:editNode('"+(jsonValue._id)+"','"+(jsonValue._rev)+"');\"><img src=\"img/edit.png\"/></a></td><td class=\"rounded-foot-right\"><a id=\"aaaa\" href=\"javascript:deleteNode('"+(jsonValue._id)+"','"+(jsonValue._rev)+"');\"><img src=\"img/delete.png\"/></a></td></tr>");						
					}
					else
					{
						$("#baseTable > tbody").append("<tr id='node"+(jsonValue._id)+"' align='center'><td>"+(jsonObject.key)+"</td><td>"+(hostcluster_name)+"</td><td>"+(jsonValue.install_nic)+"</td><td>"+(jsonValue.install_ip)+"</td><td>"+(jsonValue.install_gw)+"</td><td>"+(jsonValue.install_nmask)+"</td><td><a id=\"aaaa\" href=\"javascript:editNode('"+(jsonValue._id)+"','"+(jsonValue._rev)+"');\"><img src=\"img/edit.png\"/></a></td><td><a id=\"aaaa\" href=\"javascript:deleteNode('"+(jsonValue._id)+"','"+(jsonValue._rev)+"');\"><img src=\"img/delete.png\"/></a></td></tr>");						
					}


				}

									
					var rows = $('#baseTable tbody tr');
					
					//alert(rows.length);		

					rows.each(function() {
                    var td = $(this).find('td');
										
					$(td.eq(2)).editable({
						source: countries,
						select2: {
							width: 200
						} 
					});  
					
					
					});	

			},
			error: function(status) {
				console.log("Error in node-query/all : " + status);
			},
			reduce: false
		});	
		
		
		
		
		
		
	}

	function loadClusterList()
	{

		$.couch.db("devops").view("cluster-query/all", {
			success: function(data) {
			var nodes = data.rows;
				
			console.log("Entering loadClusterList");
			$('#existingNodeSelect').empty();
			$("#baseTableCluster  > tbody > tr").empty();		
	
			
			for(i=0;i<nodes.length;i++)
			{
				var jsonObject = nodes[i];
				var jsonValue = jsonObject.value;		
				$('#existingNodeSelect').append('<option value='+jsonValue._id+'>'+jsonValue.name+'</option>');
				
				
				//console.log("jsonValue.key : "+ jsonObject.key);
				//console.log("jsonValue._id : "+ jsonValue._id);
					if(i == nodes.length-1)
					{
						$("#baseTableCluster > tbody").append("<tr id='cluster"+(jsonValue._id)+"' align='center'><td class=\"rounded-foot-left\">"+(jsonObject.key)+"</td><td>"+(jsonValue.description)+"</td><td>"+(	jsonValue.user_name)+"</td><td class=\"rounded-foot-right\"><a id=\"aaaa\" href=\"javascript:deleteCluster('"+(jsonValue._id)+"','"+(jsonValue._rev)+"','"+(jsonObject.key)+"','Yes');\"><img src=\"img/delete.png\"/></a></td></tr>");
					}
					else
					{
						$("#baseTableCluster > tbody").append("<tr id='cluster"+(jsonValue._id)+"' align='center'><td>"+(jsonObject.key)+"</td><td>"+(jsonValue.description)+"</td><td>"+(	jsonValue.user_name)+"</td><td ><a id=\"aaaa\" href=\"javascript:deleteCluster('"+(jsonValue._id)+"','"+(jsonValue._rev)+"','"+(jsonObject.key)+"','Yes');\"><img src=\"img/delete.png\"/></a></td></tr>");						
					}
				
			}
			
			console.log("Loaded Cluster List");
			
			},
			error: function(status) {
				console.log("Error in Loaded Cluster List : " + status);
			},
			reduce: false
		});
	}
	
	function populateClusterList()
	{

		$.couch.db("devops").view("cluster-query/all", {
			success: function(data) {
			var nodes = data.rows;
				
			$('#existingNodeSelect').empty();

			for(i=0;i<nodes.length;i++)
			{
				var jsonObject = nodes[i];
				var jsonValue = jsonObject.value;		
				$('#existingNodeSelect').append('<option value='+jsonValue._id+'>'+jsonValue.name+'</option>');			
			}
			
			//console.log("Populated Cluster List");
			
			},
			error: function(status) {
				console.log("Error in Population Cluster List : " + status);
			},
			reduce: false
		});
	}
	
	function clearAll()
	{
		$("form").each(function() {
				//console.log(this.id);
				if(this.id!="deployment")
				{
					$("#"+(this.id)+"").each(function() {
						this.reset();
					});			
				}	
		});
		
		// Clear Info Tab
		$("#selectOptionLabel").text("");		
		$('.newCluster').hide();
		$('.existingNode').hide();
		
		// Clearn Basic Configuration
		chooseNodeMappingOptions();
		
		// Clean HA Configuration
		var rows = $('#HAConfigurataion div');
		rows.each(function() {

			if(this.id)
			{
				$('#'+(this.id)).hide();	
			}
		
		});

		$('#loadBalancer').hide();
		$('#deploymentSelection').show();
		
		// Clean Deployment Log Window
		
		$('#result').val("");
		
		//$('#horizonadmin').hide(); 
  		//$('#horizonadmin').attr('disabled', true);
		
	}
	
    </script> 
  
  
</head>

<body>

	<div id="conteneur">
		  <div id="header" align="center">OpenStack Cloud Maker</div>
	
	<div
		class="ui-tabs ui-widget ui-widget-content ui-corner-all  ui-helper-clearfix"
		id="tabs_main">
		
		<ul 
			class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
			<li><a class="ui-tabs-anchor" href="#tabs-11">Manage Nodes</a></li>
			<li><a class="ui-tabs-anchor" href="#tabs-21">Manage Clusters</a></li>
		</ul>
		
		<div class="ui-tabs-panel ui-widget-content ui-corner-bottom "  align="center" id="tabs-11">
		
		<div
		class="ui-tabs ui-widget ui-widget-content ui-corner-all  ui-helper-clearfix"
		id="tabs">
		<ul 
			class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
			<li><a class="ui-tabs-anchor" href="#tabs-1">Node Registration</a></li>
		</ul>

		<div class="ui-tabs-panel ui-widget-content ui-corner-bottom "  align="center" id="tabs-1" >
			
			<!--
			<h2>Node Registration</h2>
			-->
				<table border="0" width="70%">
						<tr id="baseTableHeader">
							<th scope="col" width="50%"><a href="javascript:createNode()">Register New Node</a></th>
						</tr>					
				</table>			
			
			<p></p>
		
			<form name="create_node" id="create_node" >
			 <div style="height:300px;overflow:auto;">
				<table id="baseTable" name="baseTable"  width="80%" class="roundTable">		
				<thead>		
						<tr id="baseTableHeader">
							<th scope="col" class="rounded-left" width="20%">Node Name</th>
							<th scope="col" width="10%">Cluster Name</th>
							<th scope="col" width="10%">Install NIC</th>
							<th scope="col" width="20%">Install IP</th>
							<th scope="col" width="20%">Install Gateway</th>
							<th scope="col" width="20%">Net Mask</th>
							<th scope="col" width="5%" >Edit</th>
							<th scope="col" width="5%" class="rounded-right">Delete</th>
						</tr>		
				</thead>	
				<tbody></tbody>				
				</table>
			 </div>	
			</form>
		</div>
</div>
		</div>
		<div class="ui-tabs-panel ui-widget-content ui-corner-bottom "  align="center" id="tabs-21">
		

<div
		class="ui-tabs ui-widget ui-widget-content ui-corner-all  ui-helper-clearfix"
		id="tabs1">
		<ul 
			class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
			<li><a class="ui-tabs-anchor" href="#tabs-2">Cluster List</a></li>
			<li><a class="ui-tabs-anchor" href="#tabs-3">Cluster Info</a></li>
			<li><a class="ui-tabs-anchor" href="#tabs-4">Basic Configuration</a></li>
			<li><a class="ui-tabs-anchor" href="#tabs-5">HA Configuration</a></li>
			<li><a class="ui-tabs-anchor" href="#tabs-6">Node-Role Mapping</a></li>
			<li><a class="ui-tabs-anchor" href="#tabs-7">Deployment</a></li>
		</ul>
		<div class="ui-tabs-panel ui-widget-content ui-corner-bottom"   align="center" id="tabs-2">
			<!--	
			<h2>Available Cluster List</h2>
			-->

			<p></p>
				<div style="height:300px;overflow:auto;">
				<table id="baseTableCluster"  width="70%" class="roundTable">
				<thead>
						<tr id="baseTableHeaderCluster">
							<th scope="col" width="20%" class="rounded-left">Cluster Name</th>
							<th scope="col" width="40%">Description</th>
							<th scope="col" width="20%">Username</th>
							<th scope="col" width="5%" class="rounded-right">Delete</th>
						</tr>					
				</thead>		
				<tbody></tbody>
				
				</table>
				</div>

		</div>  
		<div class="ui-tabs-panel ui-widget-content ui-corner-bottom"  align="center"  id="tabs-3">
			<!--
			<h2>Info</h2>
			-->
			<form name="info_form" id="info_form">
				<table border="0" width="60%" class="roundTable-left">
				
					<tbody>
						<TR>
							<TH class="rounded-left"><label> Select Option: </label></TH>
							<TH class="rounded-right">&nbsp;</TH>
						</TR>					
					
						<tr>
							<td colspan="2"><input id="selectOption" name="selectOption" value="New"
								type="radio">&nbsp;Create New
								Cluster&nbsp;&nbsp;&nbsp;&nbsp;<input name="selectOption"
								value="Exiting" type="radio">&nbsp;Select Existing
								Cluster</td>
						</tr>
						<tr>
							<td width="30%"><label id="selectOptionLabel"></label></td>
							<td>
								<div id="newCluster" class="newCluster">
									<table class="roundTable-left"  width="100%">
										<tbody>
											<tr>
												<td width="30%"><label> Cluster Name</label></td>
												<td><input name="name" id="name" type="text"/></td>
											</tr>
											<tr>
												<td id="subCategory"><label> Cluster
														Description: </label></td>
												<td><input name="description" type="text"/></td>
											</tr>

										</tbody>
									</table>
								</div>
								<div id="existingNode" class="existingNode">
									<table  border="0"
										width="100%">
										<tbody>
											<tr>
												<td><select name="existingNodeSelect"
													id="existingNodeSelect">
												</select></td>
											</tr>
										</tbody>
									</table>
								</div>

							</td>
						</tr>
						<tr>
							<td class="rounded-foot-left">&nbsp;</td>
							<td class="rounded-foot-right" align="right"><input id="1" class="nextButton" value="NEXT"
								type="button"> </td>
						</tr>
					</tbody>
				</table>
			</form>
			<p></p>		
		</div>
		<div class="ui-tabs-panel ui-widget-content ui-corner-bottom"  align="center"  id="tabs-4">
			<!--
			<h2>Basic Configuration</h2>
			-->
			<form name="basic_configuration" id="basic_configuration">
				<input name="featureCodeGroupID" value="FOD" type="hidden">

				<div id="basicConfiguration">
					<table class="roundTable-left" width="60%">
						<tbody>
						<TR>
							<TH width="25%" class="rounded-left">Configuration</TH>
							<TH class="rounded-right">&nbsp;</TH>
						</TR>						
							<tr>
								<td id="featureCodeCategory"><label> Database Type:
								</label></td>
								<td><select name="dbtype" id="dbtype">
										<option value="mysql">MySQL</option>
										<option value="db2">DB2</option>
								</select></td>
							</tr>
							<tr>
								<td><label> AMQP Type: </label></td>
								<td><select name="mqtype" id="mqtype">
										<option value="qpid">QPID</option>
										<option value="rabbitmq">RabbitMQ</option>
								</select></td>
							</tr>
							<tr>
								<td class="rounded-foot-left" ><label> Network Type: </label></td>
								<td class="rounded-foot-right" ><select name="networktype" id="networktype">
										<option value="quantum">Quantum</option>
										<option value="nova-network">Nova-Network</option>
								</select></td>
							</tr>

						</tbody>
					</table>
				</div>


				<p></p>
				<div id="OSOPS">
					<table summary="Speadsheet"  width="60%" class="roundTable-left">
						<TR>
							<TH class="rounded-left">OSOPS</TH>
							<TH class="rounded-right">&nbsp;</TH>
						</TR>					
						<TR>
							<TD width="25%">Public Network</TD>
							<TD><input name="pubnet" id="pubnet" type="text"></TD>
						</TR>
						<TR>
							<TD>Nova Network</TD>
							<TD ><input name="novanet" id="novanet" type="text"></TD>
						</TR>
						<TR>
							<TD class="rounded-foot-left">Management Network</TD>
							<TD class="rounded-foot-right"><input name="mgmtnet" id="mgmtnet" type="text"></TD>
						</TR>

					</TABLE>
				</div>
		

				<p></p>
				<table  summary="Speadsheet" class="roundTable-left" width="60%">
						<TR>
							<TH class="rounded-left">Glance</TH>
							<TH class="rounded-right">&nbsp;</TH>
						</TR>				
					<TR>
						<TD class="rounded-foot-left" width="25%">Image Upload</TD>
						<TD class="rounded-foot-right"><input id="image_upload" name="image_upload" value="true"
							type="radio">&nbsp;Yes&nbsp;&nbsp;&nbsp;&nbsp;<input
							name="image_upload" value="false" type="radio">&nbsp;No</TD>
					</TR>


				</TABLE>

				<div id="Quantum" class="Quantum">
					<p></p>
					<table summary="Speadsheet" class="roundTable-left" width="60%">
						<TR>
							<TH class="rounded-left">Quantum</TH>
							<TH class="rounded-right">&nbsp;</TH>
						</TR>						
						<TR>
							<TD width="25%">Tenant Network Type</TD>
							<TD><input name="tenant_network_type" id="tenant_network_type" type="text"></TD>
						</TR>
						<TR>
							<TD>Network VLAN Rang</TD>
							<TD><input name="network_vlan_range" id="network_vlan_range" type="text"></TD>
						</TR>
						<TR>
							<TD>Tunnel ID Range</TD>
							<TD><input name="tunnel_id_range" id="tunnel_id_range" type="text"></TD>
						</TR>
						<TR>
							<TD>Enable Tunneling</TD>
							<TD><input id="enableTuneling" name="enable_tunneling"
								value="true" type="radio">&nbsp;Yes&nbsp;&nbsp;&nbsp;&nbsp;<input
								name="enable_tunneling" value="false" type="radio">&nbsp;No</TD>
						</TR>
						<TR>
							<TD>Bridge Mapping NIC</TD>
							<TD><input name="bridge_mapping_nic" id="bridge_mapping_nic" type="text"></TD>
						</TR>
						<TR>
							<TD class="rounded-foot-left">Floating IP NIC</TD>
							<TD class="rounded-foot-right"><input name="floating_if" id="floating_if" type="text"></TD>
						</TR>
					</TABLE>
				</div>

				<table border="0" width="60%">
					<tbody>

						<tr>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
						</tr>
						<tr>
							<td><input class="backButton" value="BACK" type="button"></td>
							<td align="right"><input class="nextButton" id="2"
								value="NEXT" type="button"></td>
						</tr>
					</tbody>
				</table>	
			</form>	
		</div>
		<div class="ui-tabs-panel ui-widget-content ui-corner-bottom" align="center"  id="tabs-5">

			<!--	
			<h2>HA Configuration</h2>
			-->

			<form name="ha_configuration" id="ha_configuration">

				<div id="haEnabled"  class="haEnabled">
					<table border="0" width="30%">
						<tbody>
							<tr align="center">
								<td ><label> HA Enabled: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input id="haEnabledCheck" name="haEnabledCheck"
									value="Yes" type="checkbox"></label></td>
							</tr>
						</tbody>
					</table>

					<p></p>

					<div id="loadBalancer" class="loadBalancer">

						<table id="hatypeTable" summary="Speadsheet" border="0" width="60%">
							<tbody>
								<tr align="center">
									<td width="40%"><label> Load Balancer: </label></td>
									<td><select name="hatype" id="hatype">
											<option value="stingray">Stringray</option>
											<option value="haproxy">HAProxy</option>
									</select></td>
								</tr>
							</tbody>
						</table>
						
						<p></p>
						<div id="HAConfigurataion" class="HAConfigurataion" style="height:200px;overflow:auto;">
							<table class="roundTable">
								<TR>
									<TH align="center" width="10%" class="rounded-left">&nbsp;</TH>
									<TH align="center" width="10%">DB</TH>
									<TH align="center" width="10%">MQ</TH>
									<TH align="center" width="10%">KeyStone</TH>
									<TH align="center" width="10%">Glance API</TH>
									<TH align="center" width="10%">Glance Registry</TH>
									<TH align="center" width="10%">Cinder API</TH>
									<TH align="center" width="10%">NOVA API</TH>
									<TH align="center" width="10%">EC2-API</TH>
									<TH align="center" width="10%" class="rounded-right">Qunatum Server</TH>
								</TR>
								<TR align="center">
									<TD align="center" width="10%">HA Component</TD>
									<TD align="center" width="10%"><input
										name="db" id="db" value="true" type="checkbox"></TD>
									<TD align="center" width="10%"><input
										name="mq" id="mq" value="true" type="checkbox"></TD>
									<TD align="center" width="10%"><input
										name="keystone" id="keystone" value="true" type="checkbox"></TD>
									<TD align="center" width="10%"><input
										name="glance_api" id="glance_api"  value="true" type="checkbox"></TD>
									<TD align="center" width="10%"><input
										name="glance_registry" id="glance_registry"  value="true" type="checkbox"></TD>
									<TD align="center" width="10%"><input
										name="cinder_api" id="cinder_api" value="true" type="checkbox"></TD>
									<TD align="center" width="10%"><input
										name="nova_api" id="nova_api"  value="true" type="checkbox"></TD>
									<TD align="center" width="10%"><input
										name="ec2_api" id="ec2_api"  value="true" type="checkbox"></TD>
									<TD align="center" width="10%"><input
										name="quantum_server" id="quantum_server"  value="true" type="checkbox"></TD>
								</TR>
								<TR align="center">
									<TD align="center" width="10%" class="rounded-foot-left">Virtual IP</TD>
									<TD align="center" width="10%">
										<div id="rowdb">
											<label id="dbPrimaryHost"> DB2 Primary </label> <input
												id="dbtext1" name="dbtext1"
												type="text" size="12"> <label id="dbSecondaryHost">DB2
												Secondary </label><input id="dbtext2"
												name="dbtext2" type="text" size="12">
											<label id="dbVirtualIPL"> Virtual IP </label><input
												id="dbtext" name="dbtext" type="text" size="12">
										</div>
									</TD>
									<TD align="center" width="10%" >
										<div id="rowmq">
											<label id="mqPrimaryHost"> QPID Primary </label><input
												id="mqtext1" name="mqtext1"
												type="text" size="12"><label id="mqSecondaryHost">QPID
												Secondary </label><input id="mqtext2"
												name="mqtext2" type="text" size="12"><label
												id="mqVirtualIPL"> Virtual IP </label><input
												id="mqtext" name="mqtext" type="text" size="12">
										</div>
									</TD>
									<TD align="center" width="10%"><div
											id="rowkeystone">
											<input name="keystonetext" id="keystonetext"
												type="text" size="12">
										</div></TD>
									<TD align="center" width="10%"><div
											id="rowglance_api">
											<input name="glance_apitext" id="glance_apitext"
												type="text" size="12">
										</div></TD>
									<TD align="center" width="10%"><div
											id="rowglance_registry">
											<input name="glance_registrytext" id="glance_registrytext"
												type="text" size="12">
										</div></TD>
									<TD align="center" width="10%"><div
											id="rowcinder_api">
											<input name="cinder_apitext" id="cinder_apitext"
												type="text" size="12">
										</div></TD>
									<TD align="center" width="10%" id><div
											id="rownova_api">
											<input name="nova_apitext" id="nova_apitext"
												type="text" size="12">
										</div></TD>
									<TD align="center" width="10%"><div
											id="rowec2_api">
											<input name="ec2_apitext" id="ec2_apitext"
												type="text" size="12">
										</div></TD>
									<TD align="center" width="10%" class="rounded-foot-right" id=><div
											id="rowquantum_server">
											<input name="quantum_servertext" id="quantum_servertext"
												type="text" size="12">
										</div></TD>
								</TR>
							</TABLE>
						</div>




					</div>

					<table border="0" width="50%">
						<tbody>

							<tr>
								<td>&nbsp;</td>
								<td>&nbsp;</td>
							</tr>
							<tr>
								<td><input class="backButton" value="BACK" type="button"></td>
								<td align="right"><input class="nextButton" id="3"
									value="NEXT" type="button"></td>
							</tr>
						</tbody>
					</table>



				</div>
			</form>


		</div>	
		<div class="ui-tabs-panel ui-widget-content ui-corner-bottom" align="center"  id="tabs-6">
			<!--
			<h2>Node Role Mapping</h2>
			-->
			<form name="node_role_mapping" id="node_role_mapping">
	
			<div id="deploymentSelection" class="deploymentSelection">
			
					<table class="roundTable-left" >
						<tbody>
						<TR>
							<TH class="rounded-left">Deployment Selection</TH>
							<TH class="rounded-right">&nbsp;</TH>
						</TR>						
							<tr>
								<td class="rounded-foot-left" id="featureCodeCategory"><label> Deployment Selection:
								</label></td>
								<td class="rounded-foot-right"><select name="deploymentSelectionSelect" id="deploymentSelectionSelect">
									<option value="all">All In One</option>
									<option value="single">Single-Controller</option>
									<option value="multi">Multi-Node</option>
							</select></td>
							</tr>
						</tbody>
					</table>				
			</div>
				<p></p>
				<div id="NodeMapping" class="NodeMapping" style="height:400px;overflow:auto;">
					<table id="NodeMappingTable" class="roundTable">
					</TABLE>
				</div>



				<table border="0" width="50%">
					<tbody>
						<tr>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
						</tr>
						<tr>
							<td><input class="backButton" value="BACK" type="button"></td>
							<td align="right"><input class="nextButton" id="4"
								value="NEXT" type="button"></td>
						</tr>
					</tbody>
				</table>

				<p></p>

			</form>		
		</div>
		
		<div class="ui-tabs-panel ui-widget-content ui-corner-bottom"  align="center" id="tabs-7">
			<h2><div id="cluster_name"/></h2>
			<form name="deployment" id="deployment">
				<p></p>
				<table border="0" width="80%">
					<tbody>
						<tr align="center">
							<th scope="col" width="60%"><input class="btnClass" id="startDeployment"
								value="Start Deployment" type="button"></th>
							<th scope="col" width="60%"><input class="btnClass" id="cleanCluster"
								value="Clean Cluster" type="button"></th>
						</tr>
						<tr align="center">
							<td colspan="2" width="1200" height="200" >
								<!--
									<textarea id="result" rows="21" cols="100"></textarea>
								-->
								<div id="progress">
							        </div>	
							</td>
							<!--<div class="include-file">this is test</div>-->
						</tr>
						<tr align="center" width="1200">
							<td>
								<div align="center" style="width: 500px; height: 25px; position: relative; float: right;" id="horizonadmin" class="horizonadmin">
								</div>
							</td>
						</tr>
					</tbody>
				</table>
				<p></p>
				<p></p>		
			</form>			
		</div>
		
		</div>
		

</div>		
		
		</div>		
		
	</div>	
	

</div>	

</body>
</html>
